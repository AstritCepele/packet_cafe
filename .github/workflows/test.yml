name: test

on:
  pull_request:
    branches: master
  push:
    branches: master
    tags: 'v*'

jobs:
  test:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: test
      run: |
        pip install -U pip && \
        pip install codecov && \
        docker build -t packet_cafe/ui -f ./ui/Dockerfile ./ui && \
        docker build -t packet_cafe/ui-test -f ./ui/Dockerfile.test ./ui && \
        docker run packet_cafe/ui-test && \
        docker build -t packet_cafe/web -f ./web/Dockerfile ./web && \
        docker build -t packet_cafe/web-test -f ./web/Dockerfile.test ./web && \
        docker run packet_cafe/web-test && \
        codecov
