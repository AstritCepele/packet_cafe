name: test

on:
  pull_requests:
    branches: master
  push:
    branches: master
    tags: 'v*'

jobs:
  test:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: test
      run: |
        apt-get update && \
        apt-get install -y curl docker-ce python3 python3-dev python3-pip && \
        curl -sL https://deb.nodesource.com/setup_12.x | sudo -E bash - && \
        apt-get install -y nodejs && \
        docker build -t packet_cafe/ui -f ./ui/Dockerfile ./ui && \
        docker build -t packet_cafe/ui-test -f ./ui/Dockerfile.test ./ui && \
        docker run packet_cafe/ui-test && \
        codecov
        pip install -U pip && \
        pip install codecov && \
        docker build -t packet_cafe/web -f ./web/Dockerfile ./web && \
        docker build -t packet_cafe/web-test -f ./web/Dockerfile.test ./web && \
        docker run packet_cafe/web-test && \
        codecov
